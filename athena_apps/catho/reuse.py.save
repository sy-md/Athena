import json,os,time
from datetime import datetime, date

filename = "catho_log.json"

class catho: #catho 1.3v

    def builder():
       try: # 8f the file exists then continue
          with open(filename,"r") as read:
              data = json.load(read)
          return(catho.options(data))

       except FileNotFoundError: # if not there then make and rerun
             os.system("touch {}".format(filename))
             with open(filename, "w") as make:
                 lst = []
                 json.dump(lst,make,indent=4)
       return(catho.builder())

    def options(data,lst = ["fwd","mid","aft"]): # where are you currently at
       fopt = input('1.) Power 2.) Control: \n')

       if fopt == 'r':
         os.system("rm {}".format(filename))
         os.system("clear")
         return(catho.builder())

       opt = input("1.)fwd 2.)mid 3.)aft: \n")

       j = {}
       if (fopt == "1" and opt == "2") or (fopt == "1" and opt == "3"):
         for x in lst:
            j[x] = input("power:")
         print(j)
x = input("control:  ")
         cntr = [x]


       elif (fopt == "1" and opt == "1"):
         fst_pwr = input('power: ')
         j["fwd"] = fst_pwr
         x = input("control:  ")
         cntr = [x]

       current = datetime.now()
       current_time = current.strftime("%H:%M:%S")
       today = date.today()
       current_day = today.strftime("%B/%d/%Y")

       payload = {
                   lst[(int(opt) - 1) ] : {
                      'TimeStamp' : current_time ,
                      "power":  j[lst[(int(opt) - 1) ]],
                      "control": cntr
                   }
                 }

       print('sending data..')
       os.system('sleep 1')
       print('sent data')

       if len(data) < 2:
         data.append(current_day)
       data.append(payload)

       if len(data) > 3:
         print("making a new fike for this entry")
#         os.system("touch 'db/new.json' ")


       with open(filename, 'w') as write:
           json.dump(data,write,indent=3)
       return(catho.builder())

#    def power(data,opt,fopt):
#       print(data)




#               cntr = input("control: ")
#
#               payload = { opt[(int(user ) - 1)]: {"power":"","control":[]}}
#               payload[ opt[(int(user ) - 1) ] ]["control"].append(cntr)
#               payload[ opt[(int(user ) - 1)] ]["power"] = pw
#
#               return catho.send(payload,data)
#
#
#
#     def send(payload,data):
#        current = datetime.now()
#        current_time = current.strftime("%H:%M:%S")
#        today = date.today()
#        current_day = today.strftime("%B/%d/%Y")
#
#        x = data.append("{}:{}".format(current_day,current_time))
#        x = data.append(payload)
#        with open(filename, 'w') as write:
#            json.dump(data,write,indent=2)

catho.builder()
